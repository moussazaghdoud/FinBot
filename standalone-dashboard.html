<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinBot - Trade Ideas Dashboard</title>
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --accent-blue: #3b82f6;
            --accent-green: #22c55e;
            --accent-red: #ef4444;
            --accent-yellow: #eab308;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }
        .header {
            background: var(--bg-secondary);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--bg-tertiary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo { font-size: 1.5rem; font-weight: bold; color: var(--accent-blue); }
        .disclaimer-banner {
            background: rgba(239, 68, 68, 0.15);
            border-left: 4px solid var(--accent-red);
            padding: 1rem 2rem;
            margin: 1rem 2rem;
            border-radius: 0.5rem;
        }
        .disclaimer-banner h3 { color: var(--accent-red); margin-bottom: 0.5rem; }
        .disclaimer-banner ul { margin-left: 1.5rem; color: var(--text-secondary); }
        .main { padding: 1rem 2rem; max-width: 1400px; margin: 0 auto; }
        .api-key-section {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 1rem;
            margin-bottom: 1.5rem;
        }
        .api-key-section h3 { margin-bottom: 1rem; }
        .api-key-section input {
            width: 100%;
            max-width: 500px;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid var(--bg-tertiary);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: opacity 0.2s;
        }
        .btn:hover { opacity: 0.9; }
        .btn-primary { background: var(--accent-blue); color: white; }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .controls { display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
        .output-section {
            background: var(--bg-secondary);
            border-radius: 1rem;
            padding: 1.5rem;
            min-height: 400px;
        }
        .loading { text-align: center; padding: 2rem; color: var(--text-muted); }
        .trade-idea {
            background: var(--bg-tertiary);
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--accent-blue);
        }
        .trade-idea.LONG { border-left-color: var(--accent-green); }
        .trade-idea.SHORT { border-left-color: var(--accent-red); }
        .idea-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .idea-asset { font-size: 1.25rem; font-weight: bold; }
        .idea-direction {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: bold;
        }
        .idea-direction.LONG { background: rgba(34, 197, 94, 0.2); color: var(--accent-green); }
        .idea-direction.SHORT { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); }
        .idea-thesis { margin-bottom: 1rem; }
        .idea-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .idea-metric {
            background: var(--bg-primary);
            padding: 0.75rem;
            border-radius: 0.5rem;
        }
        .metric-label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; }
        .metric-value { font-size: 1.1rem; font-weight: 600; }
        .metric-value.positive { color: var(--accent-green); }
        .metric-value.negative { color: var(--accent-red); }
        .idea-section { margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--bg-primary); }
        .idea-section h4 { font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.5rem; }
        .idea-section ul { margin-left: 1.25rem; color: var(--text-secondary); }
        .risks-box {
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid var(--accent-red);
            padding: 1rem;
            border-radius: 0 0.5rem 0.5rem 0;
            margin-top: 1rem;
        }
        .risks-box h4 { color: var(--accent-red); }
        .error-msg { color: var(--accent-red); padding: 1rem; text-align: center; }
        .market-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .market-card {
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 0.75rem;
        }
        .market-card h4 { color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; }
        .market-price { font-size: 1.5rem; font-weight: bold; }
        .market-change.positive { color: var(--accent-green); }
        .market-change.negative { color: var(--accent-red); }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">FinBot</div>
        <div style="color: var(--text-muted);">AI-Powered Trade Ideas (Educational)</div>
    </header>

    <div class="disclaimer-banner">
        <h3>IMPORTANT DISCLAIMER</h3>
        <p>All content is for <strong>EDUCATIONAL PURPOSES ONLY</strong>. This is NOT financial advice.</p>
        <ul>
            <li>NO GUARANTEES - Markets are unpredictable</li>
            <li>You could lose some or ALL of your investment</li>
            <li>Past performance does NOT indicate future results</li>
            <li>Always do your own research (DYOR)</li>
            <li>Consult a licensed financial advisor before investing</li>
        </ul>
    </div>

    <main class="main">
        <div class="api-key-section">
            <h3>OpenAI API Key</h3>
            <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                Enter your OpenAI API key to generate AI-powered trade ideas.
                Your key is stored only in your browser and sent directly to OpenAI.
            </p>
            <input type="password" id="api-key" placeholder="sk-..." />
            <p style="font-size: 0.75rem; color: var(--text-muted);">
                Get your API key at <a href="https://platform.openai.com/api-keys" target="_blank" style="color: var(--accent-blue);">platform.openai.com/api-keys</a>
            </p>
        </div>

        <div class="market-summary" id="market-summary">
            <div class="market-card">
                <h4>Loading market data...</h4>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-primary" id="btn-generate" onclick="generateTradeIdeas()">
                Generate Trade Ideas
            </button>
            <button class="btn btn-secondary" onclick="generateWeeklyOutlook()">
                Weekly Outlook
            </button>
            <button class="btn btn-secondary" onclick="fetchMarketData()">
                Refresh Markets
            </button>
        </div>

        <div class="output-section" id="output">
            <p class="loading">Enter your OpenAI API key and click "Generate Trade Ideas" to start.</p>
        </div>
    </main>

    <script>
        let marketData = {};

        // Fetch market data from Yahoo Finance (via a CORS proxy for browser)
        async function fetchMarketData() {
            const symbols = ['SPY', 'QQQ', '^VIX', 'BTC-USD', 'GC=F'];
            const summaryDiv = document.getElementById('market-summary');
            summaryDiv.innerHTML = '<div class="market-card"><h4>Loading...</h4></div>';

            try {
                // Using a free proxy - in production use your own backend
                const results = await Promise.all(symbols.map(async (symbol) => {
                    try {
                        const url = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=1d&range=5d`;
                        const response = await fetch(url);
                        const data = await response.json();
                        if (data.chart?.result?.[0]) {
                            const r = data.chart.result[0];
                            const price = r.meta.regularMarketPrice;
                            const prevClose = r.meta.previousClose;
                            const change = ((price - prevClose) / prevClose) * 100;
                            return { symbol, name: r.meta.shortName || symbol, price, change };
                        }
                    } catch (e) {
                        console.log(`Failed to fetch ${symbol}`);
                    }
                    return null;
                }));

                const valid = results.filter(r => r);
                marketData = valid;

                if (valid.length > 0) {
                    summaryDiv.innerHTML = valid.map(m => `
                        <div class="market-card">
                            <h4>${m.name}</h4>
                            <div class="market-price">$${m.price?.toLocaleString(undefined, {maximumFractionDigits: 2})}</div>
                            <div class="market-change ${m.change >= 0 ? 'positive' : 'negative'}">
                                ${m.change >= 0 ? '+' : ''}${m.change?.toFixed(2)}%
                            </div>
                        </div>
                    `).join('');
                } else {
                    summaryDiv.innerHTML = '<div class="market-card"><h4>Could not fetch market data (CORS blocked)</h4><p style="color: var(--text-muted);">Run with a backend server for live data</p></div>';
                }
            } catch (e) {
                summaryDiv.innerHTML = '<div class="market-card"><h4>Market data unavailable</h4></div>';
            }
        }

        async function generateTradeIdeas() {
            const apiKey = document.getElementById('api-key').value.trim();
            const output = document.getElementById('output');
            const btn = document.getElementById('btn-generate');

            if (!apiKey || !apiKey.startsWith('sk-')) {
                output.innerHTML = '<p class="error-msg">Please enter a valid OpenAI API key (starts with sk-)</p>';
                return;
            }

            btn.disabled = true;
            btn.textContent = 'Generating...';
            output.innerHTML = '<p class="loading">Analyzing markets and generating trade ideas... This may take 30-60 seconds.</p>';

            const prompt = buildTradeIdeasPrompt();

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            { role: 'system', content: getSystemPrompt() },
                            { role: 'user', content: prompt }
                        ],
                        temperature: 0.7,
                        max_tokens: 3000
                    })
                });

                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.error?.message || 'API request failed');
                }

                const data = await response.json();
                const content = data.choices[0].message.content;

                // Try to parse JSON
                let parsed;
                try {
                    const jsonMatch = content.match(/\{[\s\S]*\}/);
                    parsed = jsonMatch ? JSON.parse(jsonMatch[0]) : null;
                } catch (e) {
                    parsed = null;
                }

                if (parsed && parsed.tradeIdeas) {
                    renderTradeIdeas(parsed);
                } else {
                    output.innerHTML = `<div style="white-space: pre-wrap;">${content}</div>`;
                }

            } catch (error) {
                output.innerHTML = `<p class="error-msg">Error: ${error.message}</p>`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'Generate Trade Ideas';
            }
        }

        async function generateWeeklyOutlook() {
            const apiKey = document.getElementById('api-key').value.trim();
            const output = document.getElementById('output');

            if (!apiKey || !apiKey.startsWith('sk-')) {
                output.innerHTML = '<p class="error-msg">Please enter a valid OpenAI API key</p>';
                return;
            }

            output.innerHTML = '<p class="loading">Generating weekly outlook...</p>';

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            { role: 'system', content: getSystemPrompt() },
                            { role: 'user', content: buildWeeklyOutlookPrompt() }
                        ],
                        temperature: 0.7,
                        max_tokens: 2500
                    })
                });

                const data = await response.json();
                output.innerHTML = `<div style="white-space: pre-wrap; line-height: 1.8;">${data.choices[0].message.content}</div>`;
            } catch (error) {
                output.innerHTML = `<p class="error-msg">Error: ${error.message}</p>`;
            }
        }

        function getSystemPrompt() {
            return `You are a financial market analyst providing EDUCATIONAL analysis and trade ideas.

CRITICAL RULES:
1. All analysis is for EDUCATIONAL PURPOSES ONLY - state this clearly
2. Include "NOT FINANCIAL ADVICE" in every response
3. Never guarantee returns - use words like "potential", "possible", "historical patterns suggest"
4. Always present BOTH bull and bear cases
5. Include risk warnings for every idea
6. Use probability language: "60% probability" not "will happen"

Analyze markets and provide educational trade ideas with entry/exit suggestions, risk/reward ratios, and what could go wrong.`;
        }

        function buildTradeIdeasPrompt() {
            let marketInfo = 'Current market data:\n';
            if (marketData.length > 0) {
                marketData.forEach(m => {
                    marketInfo += `- ${m.name}: $${m.price?.toFixed(2)} (${m.change >= 0 ? '+' : ''}${m.change?.toFixed(2)}%)\n`;
                });
            } else {
                marketInfo += '(Market data not available - use your knowledge of current conditions)\n';
            }

            return `${marketInfo}

Based on current market conditions, technical analysis, and recent geopolitical/economic news, generate 3-4 educational trade ideas.

For each idea provide:
1. Asset (stock ETF, crypto, commodity, forex)
2. Direction (LONG or SHORT)
3. Conviction level (LOW/MEDIUM/HIGH) and confidence % (max 70%)
4. Entry price/condition
5. Target prices with potential gain %
6. Stop loss with potential loss %
7. Risk/reward ratio
8. Technical and fundamental reasoning
9. Bull case and bear case
10. Specific risks
11. What would invalidate this idea
12. Educational lesson this trade demonstrates

Format as JSON:
{
  "disclaimer": "FOR EDUCATIONAL PURPOSES ONLY. NOT FINANCIAL ADVICE.",
  "marketContext": "Current market summary",
  "tradeIdeas": [
    {
      "asset": "Symbol",
      "direction": "LONG/SHORT",
      "conviction": "LOW/MEDIUM/HIGH",
      "confidencePercent": 50-70,
      "thesis": "Why this makes sense",
      "entry": { "price": "X", "condition": "Enter when..." },
      "targets": [{ "price": "X", "potentialGain": "X%", "probability": "X%" }],
      "stopLoss": { "price": "X", "potentialLoss": "X%", "reasoning": "Why" },
      "riskReward": "1:X",
      "timeHorizon": "Days/Weeks",
      "technicalFactors": ["Factor 1", "Factor 2"],
      "fundamentalFactors": ["Factor 1", "Factor 2"],
      "bullCase": "What if it works",
      "bearCase": "What could go wrong",
      "risks": ["Risk 1", "Risk 2", "Risk 3"],
      "invalidation": "This idea is wrong if...",
      "educationalNote": "What this teaches"
    }
  ],
  "marketRisks": ["Risk 1", "Risk 2"],
  "finalReminder": "Remember: This is education only."
}`;
        }

        function buildWeeklyOutlookPrompt() {
            return `Generate a weekly market outlook for educational purposes. Include:

1. Market bias (BULLISH/BEARISH/NEUTRAL) with reasoning
2. Key support and resistance levels for S&P 500, NASDAQ, Bitcoin
3. Upcoming economic events/catalysts
4. Sector outlook
5. What could go wrong
6. Best practices for the week
7. Educational tip

Start with a clear disclaimer that this is educational content only.`;
        }

        function renderTradeIdeas(data) {
            const output = document.getElementById('output');

            let html = `
                <div style="background: rgba(239,68,68,0.1); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; border-left: 4px solid var(--accent-red);">
                    <strong style="color: var(--accent-red);">${data.disclaimer || 'FOR EDUCATIONAL PURPOSES ONLY'}</strong>
                </div>
                <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.5rem;">
                    <h3>Market Context</h3>
                    <p>${data.marketContext || ''}</p>
                </div>
            `;

            if (data.tradeIdeas) {
                data.tradeIdeas.forEach(idea => {
                    html += `
                        <div class="trade-idea ${idea.direction}">
                            <div class="idea-header">
                                <div>
                                    <span class="idea-asset">${idea.asset}</span>
                                    <span style="margin-left: 0.5rem; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; background: ${idea.conviction === 'HIGH' ? 'var(--accent-green)' : idea.conviction === 'MEDIUM' ? 'var(--accent-yellow)' : 'var(--accent-red)'}; color: ${idea.conviction === 'MEDIUM' ? 'black' : 'white'};">${idea.conviction}</span>
                                </div>
                                <span class="idea-direction ${idea.direction}">${idea.direction}</span>
                            </div>
                            <div class="idea-thesis">${idea.thesis}</div>
                            <div class="idea-grid">
                                <div class="idea-metric">
                                    <div class="metric-label">Entry</div>
                                    <div class="metric-value">${idea.entry?.price || '--'}</div>
                                </div>
                                <div class="idea-metric">
                                    <div class="metric-label">Target</div>
                                    <div class="metric-value positive">${idea.targets?.[0]?.price || '--'} (${idea.targets?.[0]?.potentialGain || '--'})</div>
                                </div>
                                <div class="idea-metric">
                                    <div class="metric-label">Stop Loss</div>
                                    <div class="metric-value negative">${idea.stopLoss?.price || '--'}</div>
                                </div>
                                <div class="idea-metric">
                                    <div class="metric-label">Risk/Reward</div>
                                    <div class="metric-value">${idea.riskReward || '--'}</div>
                                </div>
                            </div>
                            <div class="idea-section">
                                <h4>Technical Factors</h4>
                                <ul>${(idea.technicalFactors || []).map(f => `<li>${f}</li>`).join('')}</ul>
                            </div>
                            <div class="idea-section">
                                <h4>Fundamental Factors</h4>
                                <ul>${(idea.fundamentalFactors || []).map(f => `<li>${f}</li>`).join('')}</ul>
                            </div>
                            <div class="idea-section">
                                <h4>Bull Case</h4>
                                <p>${idea.bullCase || ''}</p>
                            </div>
                            <div class="idea-section">
                                <h4>Bear Case</h4>
                                <p>${idea.bearCase || ''}</p>
                            </div>
                            <div class="risks-box">
                                <h4>RISKS</h4>
                                <ul>${(idea.risks || []).map(r => `<li>${r}</li>`).join('')}</ul>
                                <p style="margin-top: 0.5rem;"><strong>Invalidation:</strong> ${idea.invalidation || ''}</p>
                            </div>
                            <div class="idea-section" style="background: var(--bg-primary); padding: 1rem; border-radius: 0.5rem;">
                                <h4>Educational Note</h4>
                                <p>${idea.educationalNote || ''}</p>
                            </div>
                        </div>
                    `;
                });
            }

            if (data.marketRisks) {
                html += `
                    <div class="risks-box">
                        <h4>Overall Market Risks</h4>
                        <ul>${data.marketRisks.map(r => `<li>${r}</li>`).join('')}</ul>
                    </div>
                `;
            }

            html += `
                <div style="text-align: center; padding: 1.5rem; color: var(--text-muted); font-style: italic; border-top: 1px solid var(--bg-tertiary); margin-top: 1rem;">
                    ${data.finalReminder || 'Remember: This is education only. You are responsible for your own investment decisions.'}
                </div>
            `;

            output.innerHTML = html;
        }

        // Load market data on page load
        fetchMarketData();
    </script>
</body>
</html>
